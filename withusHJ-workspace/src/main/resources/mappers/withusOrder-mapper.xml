<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="withusOrderMapper">

	<resultMap type="Order" id="orderRset">
		<result column="order_no" property="orderNo"/>
		<result column="project_no" property="projectNo"/>
		<result column="member_no" property="memberNo"/>
		<result column="reward_no" property="rewardNo"/>
		<result column="pur_email" property="purEmail"/>
		<result column="order_plus" property="orderPlus"/>
		<result column="total_price" property="totalPrice"/>
		<result column="order_status" property="orderStatus"/>
		<result column="bank_name" property="bankName"/>
		<result column="bank_account" property="bankAccount"/>
		<result column="receiver_name" property="receiverName"/>
		<result column="receiver_phone" property="receiverPhone"/>
		<result column="address_no" property="addressNo"/>
		<result column="address_detail" property="addressDetail"/>
		<result column="address" property="address"/>
		<result column="shipping_status" property="shippingStatus"/>
		<result column="shipping_req" property="shippingReq"/>
		<result column="shipping_com" property="shippingCom"/>
		<result column="shipping_no" property="shippingNo"/>
		<result column="order_date" property="orderDate"/>
		<result column="order_count" property="orderCount"/>
		<result column="order_option" property="orderOption"/>
		
		<result column="supporter_name" property="supporterName"/>
		<result column="partner_name" property="partnerName"/>
		<result column="project_end_dt" property="projectEndDt"/>
		<result column="project_Title" property="projectTitle"/>
		<result column="reward_Title" property="rewardTitle"/>
		<result column="reward_price" property="rewardPrice"/>
		<result column="card_no" property="cardNo"/>
		<result column="delivery_date" property="deliveryDate"/>
	</resultMap>
		
	
	<!-- 페이징 처리 -->
	<select id="oSelectListCount" resultType="_int">
		select
			   count(*)
		from tb_order
	</select>
	
	<!-- 주문내역 리스트 -->
	<select id="oSelectList" resultMap="orderRset">
		select
			   order_no
		     , member_name supporter_name
             , p.project_title
             , reward_title
             , order_option
             , order_count
		     , to_char(order_date,'YYYY-MM-DD HH24:MI:SS') order_date
			 , order_status
			 , shipping_status
		  from tb_order o 
          join member using (member_no)
          full join project p
          on (o.project_no = p.project_no)
         join reward using (reward_no)
		 order
		    by order_no desc
	</select>

	<!-- 상세조회 -->	
	<select id="selectOrderDetail" resultMap="orderRset"
            parameterType="_int">
		select 
		        order_no
		      , order_date
		      , sm.member_name supporter_name
		      , to_char(project_end_dt, 'YYYY-MM-DD') project_end_dt
		      , order_status
		      , pm.member_name  partner_name
		      , project_title
		      , reward_title
		      , order_option
		      , order_count
		      , reward_price
		      , order_plus
		      , to_char(total_price, '999,999,999,999,999')total_price
		      , card_no
		      , receiver_name
		      , address_no
		      , address_detail
		      , address
		      , receiver_phone
		      , shipping_req
		      , shipping_status
		   from tb_order o
		   join member sm on(o.member_no = sm.member_no)
		   join pay using(order_no)
		   join reward using(project_no)
		   join project p using(project_no)
		   join member pm on(p.member_no = pm.member_no)
		   where order_no = #{orderNo}
	</select>
	
	<!-- 사용자(파트너) -->
	<!-- 발송리스트 갯수 -->
	<select id="SelectDeliveryCount" resultType="_int">
			select
			   count(*)
		from tb_order
		<!-- 파트너가 게시한 프로젝트만 출력, 로그인한 mem_no = 프로젝트 mem_no-->
	</select>
	<!-- 파트너 발송관리 -->
	<select id="selectOrderNDelivery" resultMap="orderRset">
		select 
		        o.order_no
		      , m.member_name supporter_name
		      , o.order_status
		      , to_char(o.total_price, '999,999,999,999,999')total_price
              , r.reward_title
      		  , o.order_option
      		  , o.order_count
		      , o.shipping_status
		      , o.shipping_com
		      , o.shipping_no
		      , (select 
		         to_char(delivery_date, 'YYYY-MM-DD')delivery_date 
		           from project p 
		           where p.project_no = o.project_no) delivery_date  
		   from tb_order o
  		   join member m on(o.member_no = m.member_no)
 		   join reward r on(o.project_no = r.project_no)
	</select>
	

</mapper>
			  